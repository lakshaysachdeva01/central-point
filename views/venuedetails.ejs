<%- include('header'), {seoDetails} %>

<% 
  // Function to extract video ID from YouTube URL
  function getYouTubeVideoId(url) {
    if (!url) return '';
    let videoId = '';
    if (url.includes('youtu.be/')) {
      videoId = url.split('youtu.be/')[1]?.split('?')[0];
    } else if (url.includes('youtube.com/watch')) {
      videoId = url.split('v=')[1]?.split('&')[0];
    } else if (url.includes('youtube.com/embed/')) {
      videoId = url.split('youtube.com/embed/')[1]?.split('?')[0];
    }
    return videoId;
  }

  // YouTube video URL from venue data
  const youtubeUrl = venue && venue.youtubeVideo ? venue.youtubeVideo : '';
  const videoId = getYouTubeVideoId(youtubeUrl);
  const hasYouTubeVideo = videoId && videoId !== '';
%>

<header class="header">
    <div class="video-fullscreen-wrap">
        <div class="video-fullscreen-video" data-overlay-dark="4">
            <% if (hasYouTubeVideo) { %>
                <!-- YouTube Video Embed -->
                <div class="youtube-video-container" id="youtube-venue-video">
                    <iframe 
                        id="youtube-venue-iframe"
                        class="youtube-banner-iframe"
                        src="https://www.youtube.com/embed/<%= videoId %>?autoplay=1&mute=1&loop=1&playlist=<%= videoId %>&controls=0&modestbranding=1&rel=0&showinfo=0&iv_load_policy=3&disablekb=1&fs=0&playsinline=1&enablejsapi=1&origin=<%= typeof baseUrl !== 'undefined' ? encodeURIComponent(baseUrl) : '' %>"
                        frameborder="0"
                        allow="autoplay; encrypted-media"
                        allowfullscreen="false"
                        title="<%= venue.title %>"
                        loading="eager">
                    </iframe>
                    <!-- Overlay to block all user interactions -->
                    <div class="youtube-video-overlay"></div>
                </div>
            <% } else if (venue && venue.bannerImage) { %>
                <!-- Fallback to banner image -->
                <div class="venue-detail-banner-img" style="background-image: url('<%= venue.bannerImage %>'); background-size: cover; background-position: center;"></div>
            <% } %>
        </div>
        <div class="v-middle">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 col-md-12 text-center">
                        <% if (venue && venue.tagline) { %>
                            <h5><%= venue.tagline %></h5>
                        <% } %>
                        <% if (venue && venue.title) { %>
                            <h1><%= venue.title %></h1>
                        <% } %>
                        <div class="details"> 
                            <% if (venue && venue.venueDetails && venue.venueDetails.capacity) { %>
                                <span><i class="fa-thin fa-user"></i><%= venue.venueDetails.capacity %></span>
                            <% } %>
                            <% if (venue && venue.venueDetails && venue.venueDetails.area) { %>
                                <span><i class="fa-thin fa-expand"></i><%= venue.venueDetails.area %></span>
                            <% } %>
                            <% if (venue && venue.venueDetails && venue.venueDetails.type) { %>
                                <span><i class="fa-thin fa-building"></i><%= venue.venueDetails.type %></span>
                            <% } %>
                            <% if (venue && venue.venueDetails && venue.venueDetails.style) { %>
                                <span><i class="fa-thin fa-star"></i><%= venue.venueDetails.style %></span> 
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<% if (hasYouTubeVideo) { %>
<script>
  // Load YouTube IFrame API
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  var ytVenuePlayer;
  
  function onYouTubeIframeAPIReady() {
    ytVenuePlayer = new YT.Player('youtube-venue-iframe', {
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  function onPlayerReady(event) {
    // Set video quality to highest available (2160p if available)
    event.target.setPlaybackQuality('hd2160');
    // Force quality if available, otherwise fallback to next highest
    setTimeout(function() {
      var quality = event.target.getPlaybackQuality();
      if (quality !== 'hd2160') {
        // Try to set to highest available quality
        event.target.setPlaybackQuality('highres');
      }
    }, 1000);
    
    // Ensure video is playing and muted
    event.target.mute();
    event.target.playVideo();
  }

  function onPlayerStateChange(event) {
    // Loop the video when it ends
    if (event.data === YT.PlayerState.ENDED) {
      event.target.playVideo();
    }
  }

  // Expose function globally for YouTube API
  window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
</script>
<% } %>

<style>
    .col-lg-7 {
        position: sticky;
        top: 125px;
        align-self: self-start;
    }
</style>

<!-- Venue Details -->
<section class="page-details section-padding">
    <div class="container">
        <div class="row">
            <div class="col-lg-7 col-md-12 mb-30">
                <div class="row mb-30">
                    <div class="col-md-12">
                        <% if (venue && venue.tagline) { %>
                            <div class="section-subtitle"><%= venue.tagline %></div>
                        <% } %>
                        <% if (venue && venue.title) { %>
                            <div class="section-title"><%= venue.title %></div>
                        <% } %>
                        <% if (venue && venue.detailDescription) { %>
                            <% const paragraphs = venue.detailDescription.split('\n\n'); %>
                            <% paragraphs.forEach(paragraph => { %>
                                <p><%= paragraph %></p>
                            <% }); %>
                        <% } %>
                    </div>
                </div>
                <% if (venue && venue.suitableFor && venue.suitableFor.length > 0) { %>
                    <div class="row mb-30">
                        <div class="col-md-12">
                            <h5>Suitable For</h5>
                            <ul class="list-unstyled page-list">
                                <% venue.suitableFor.forEach(item => { %>
                                    <li>
                                        <div class="page-list-icon"> <span class="ti-check"></span> </div>
                                        <div class="page-list-text">
                                            <p><%= item %></p>
                                        </div>
                                    </li>
                                <% }); %>
                            </ul>
                        </div>
                    </div>
                <% } %>
            </div>
            <div class="col-lg-4 offset-lg-1 col-md-12">
                <div class="cont">
                    <h5>Venue Amenities</h5>
                    <ul class="list">
                        <% if (venue && venue.amenities && venue.amenities.length > 0) { %>
                            <% venue.amenities.forEach(amenity => { %>
                                <li>
                                    <% if (typeof amenity === 'string') { %>
                                        <span><i class="fa-regular fa-check"></i></span>
                                        <span><%= amenity %></span>
                                    <% } else { %>
                                        <span><i class="<%= amenity.icon || 'fa-regular fa-check' %>"></i></span>
                                        <span><%= amenity.text || amenity %></span>
                                    <% } %>
                                </li>
                            <% }); %>
                        <% } %>
                    </ul>
                </div>
                <% if (venue && venue.importantNotes && venue.importantNotes.length > 0) { %>
                    <div class="cont mt-4">
                        <h5>Important Notes</h5>
                        <ul class="list">
                            <% venue.importantNotes.forEach(note => { %>
                                <li>
                                    <span><i class="fa-regular fa-info-circle"></i></span>
                                    <span><%= note %></span>
                                </li>
                            <% }); %>
                        </ul>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</section>
<!-- Gallery Image -->
<% if (venue && venue.detailImages && venue.detailImages.length > 0) { %>
    <section class="galleryscroll section-padding bg-darkgray">
        <div class="container-fluid p-0">
            <div class="row justify-content-center">
                <div class="col-md-12 text-center mb-20">
                    <div class="section-subtitle">Venue Images</div>
                    <% if (venue && venue.title) { %>
                        <div class="section-title white"><%= venue.title %></div>
                    <% } %>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="owl-carousel owl-theme">
                        <% venue.detailImages.forEach((image) => { %>
                            <div class="item">
                                <a href="<%= image %>" title="<%= venue.title %>" class="gallery-masonry-item-img-link img-zoom">
                                    <div class="img"> <img src="<%= image %>" class="img-fluid mx-auto d-block" alt="<%= venue.title %>"> </div>
                                </a>
                            </div>
                        <% }); %>
                    </div>
                </div>
            </div>
        </div>
    </section>
<% } %>

<style>
    /* Venue Detail Banner Image Styling */
    .venue-detail-banner-img {
        width: 586px;
        height: 527px;
        margin: 0 auto;
    }
    
    @media (max-width: 768px) {
        .venue-detail-banner-img {
            width: 100%;
            aspect-ratio: 1 / 1;
            height: auto;
        }
    }
</style>

<%- include('footer') %>

