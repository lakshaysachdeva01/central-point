<!--   Banner of blog    -->
  <!-- Header Banner -->
  <section class="banner-header full-height valign bg-img" data-overlay-dark="5" data-background="<%= blogDetails?.coverImage ? process.env.S3_BASE_URL + blogDetails.coverImage : '/assets/img/blog/1.jpg' %>">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-12 col-md-12 text-center">
                
                <h1 class="title"><%= blogDetails.title %></h1>
                
            </div>
        </div>
    </div>
</section>


<!--   Banner of blog    -->
<% // Function to convert a YouTube URL (watch or short form) into an embeddable URL 
function convertToEmbedUrl(url) {
    let videoId = "";
    if (url.includes("youtu.be")) {
        // Handle short URL format (e.g., https://youtu.be/Tjxx80uYyUQ)
        videoId = url.split("youtu.be/")[1]?.split("?")[0];
    } else if (url.includes("youtube.com/watch")) {
        // Handle full URL format (e.g., https://www.youtube.com/watch?v=Tjxx80uYyUQ)
        videoId = url.split("v=")[1]?.split("&")[0];
    }
    return videoId ? `https://www.youtube.com/embed/${videoId}` : "";
} %>

<section class="post section-padding">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <% if (blogDetails?.banner?.bannerType === "VIDEO" && blogDetails?.banner?.video && blogDetails?.banner?.video !== "") { %>
                <!-- Render video if the banner type is VIDEO and video URL exists -->
                <iframe width="100%" height="633" src="<%= convertToEmbedUrl(blogDetails.banner.video) %>"
                    title="YouTube video player" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
                </iframe>
                <% } else if (blogDetails?.banner?.bannerType === "IMAGE" && blogDetails?.banner?.image) { %>
                <!-- Render image if the banner type is IMAGE and image URL exists -->
                <div class="popup-trigger" data-type="image" data-src="<%= process.env.S3_BASE_URL + blogDetails.banner.image %>">
                    <img src="<%= process.env.S3_BASE_URL + blogDetails.banner.image %>" class="rounded-2 img-fluid" alt="blog_banner">
                </div>
                <% } %>
                
             
                
                <!-- Blog main description -->
                <div class="blog-description mt-30 mb-30">
                    <%- blogDetails.description.replace(/<span[^>]*>/g, '').replace(/<\/span>/g, '').replace(/\n/g, '<br>') %>
                </div>
            </div>

            <% if (blogDetails?.multipleDescriptions?.length > 0) { %>
                <% blogDetails.multipleDescriptions.forEach((item, index) => { %>
                    <div class="col-lg-10 <%= index === blogDetails.multipleDescriptions.length - 1 ? '' : '' %>">
                        <!-- Description content -->
                        <% if (item.description) { %>
                            <div class="item-description mb-30">
                                <%- (item.description || '').replace(/<span[^>]*>/g, '').replace(/<\/span>/g, '').replace(/\n/g, '<br>') %>
                            </div>
                        <% } %>

                        <!-- Single Image -->
                        <% if (item?.singleImage?.image) { %>
                            <div class="popup-trigger" data-type="image" data-src="<%= process.env.S3_BASE_URL + item.singleImage.image %>">
                                <img src="<%= process.env.S3_BASE_URL + item.singleImage.image %>" 
                                    class="rounded-2 img-fluid mb-30" 
                                    alt="<%= item.singleImage.altTag || 'Image' %>">
                            </div>
                        <% } %>

                        <!-- Multiple Images with Bootstrap grid -->
                        <% if (item?.multipleImages?.length > 0) { 
                            let imageCount = item.multipleImages.length;
                            let colClass = '';
                            
                            if (imageCount === 1) {
                                colClass = 'col-12';
                            } else if (imageCount === 2) {
                                colClass = 'col-lg-6 col-md-12';
                            } else if (imageCount === 3) {
                                colClass = 'col-lg-4 col-md-12';
                            } else if (imageCount === 4) {
                                colClass = 'col-lg-3 col-md-6';
                            } else {
                                colClass = 'col-lg-4 col-md-6';
                            }
                        %>
                            <div class="row">
                                <% item.multipleImages.forEach((image, imgIndex) => { %>
                                    <div class="<%= colClass %>  h-full">
                                        <div class="popup-trigger h-full" data-type="image" data-src="<%= process.env.S3_BASE_URL + image %>">
                                            <img src="<%= process.env.S3_BASE_URL + image %>" 
                                                class="mb-30 rounded-2 img-fluid" 
                                                alt="Image <%= imgIndex + 1 %>">
                                        </div>
                                    </div>
                                <% }) %>
                            </div>
                        <% } %>

                        <!-- Instagram Embed -->
                        <% if (item.instagram) { %>
                            <div class="instagram-embed mb-30 text-center">
                                <%- item.instagram %>
                            </div>
                            <script>
                                // Load Instagram's embed.js if not already loaded
                                if (!window.instgrm) {
                                    const script = document.createElement('script');
                                    script.src = 'https://www.instagram.com/embed.js';
                                    script.async = true;
                                    document.body.appendChild(script);
                                }
                            </script>
                        <% } %>

                        <!-- Facebook Video Embed -->
                        <% if (item.facebook) { %>
                            <div class="facebook-embed mb-30 text-center">
                                <div class="fb-video" data-href="<%= item.facebook %>" data-width="540" data-show-text="false"
                                    data-allowfullscreen="true"></div>
                            </div>
                        <% } %>

                        <!-- YouTube Video -->
                        <% if (item?.youtube && item?.youtube !== "") {
                            const embedUrl = convertToEmbedUrl(item.youtube);
                            if (embedUrl) { %>
                                <div class="mb-30">
                                    <iframe width="100%" height="550" 
                                        src="<%= embedUrl %>" title="YouTube video player" frameborder="0"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                        referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
                                    </iframe>
                                </div>
                            <% } else { %>
                                <p class="text-center mb-30">Invalid YouTube URL provided.</p>
                            <% } 
                        } %>

                        <!-- Blockquote (if needed) -->
                        <% if (item.blockquote) { %>
                            <blockquote class="mb-30">
                                <p><%= item.blockquote.text %></p>
                                <% if (item.blockquote.cite) { %>
                                    <cite><%= item.blockquote.cite %></cite>
                                <% } %>
                            </blockquote>
                        <% } %>

                        <!-- Button -->
                        <% if (item?.button && item?.button?.hyperLink !== "" && item?.button?.title !== "") { %>
                            <div class="text-center mb-30">
                                <a href="<%= item?.button?.hyperLink %>" target="_blank" class="btn-style1">
                                    <span>
                                        <%= item?.button?.title %>
                                        <svg class="ms-2" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="none">
                                            <path class="stroke-white"
                                                d="M21.1059 12.2562H0.5V11.7443H21.1059H22.313L21.4594 10.8907L17.0558 6.48705L17.4177 6.12508L23.2929 12.0002L17.4177 17.8754L17.0558 17.5134L21.4594 13.1098L22.313 12.2562H21.1059Z"
                                                stroke="white" />
                                        </svg>
                                    </span>
                                </a>
                            </div>
                        <% } %>
                    </div>
                <% }) %>
            <% } %>
        </div>
    </div>
</section>



<!-- Facebook SDK -->
<div id="fb-root"></div>
<script>
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v18.0";
        js.async = true;
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>

<!-- Add this script to fix and render the table -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const blogDescription = document.querySelector('.blog-description');

        if (blogDescription) {
            const content = blogDescription.innerHTML || '';

            // Check if content contains encoded table tags
            if (content.includes('&lt;table') && content.includes('&lt;thead') && content.includes('&lt;tbody')) {
                try {
                    // Create a temporary div to decode HTML entities
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = content;
                    let decodedContent = tempDiv.textContent;

                    // Remove paragraph tags and clean up the HTML
                    decodedContent = decodedContent
                        .replace(/<\/?p>/g, '') // Remove <p> and </p> tags
                        .replace(/&nbsp;/g, '') // Remove &nbsp;
                        .replace(/\s+</g, '<')  // Remove whitespace before tags
                        .replace(/>\s+/g, '>')  // Remove whitespace after tags
                        .trim();

                    // Replace the content with the cleaned table HTML
                    blogDescription.innerHTML = decodedContent;

                    // Add the table-container class to the blog-description div
                    blogDescription.classList.add('table-container');
                } catch (error) {
                    console.error('Error processing table HTML:', error);
                }
            }
        }

        // Get all item-description elements
        const itemDescriptions = document.querySelectorAll('.item-description');

        itemDescriptions.forEach(function(itemDescription) {
            const content = itemDescription.innerHTML || '';

            // Check if content contains encoded table tags
            if (content.includes('&lt;table') || content.includes('<table')) {
                try {
                    // Step 1: Find the table part in the content
                    const tableStartIndex = content.indexOf('&lt;table');
                    const tableEndIndex = content.indexOf('&lt;/table&gt;') + '&lt;/table&gt;'.length;

                    if (tableStartIndex !== -1 && tableEndIndex !== -1) {
                        // Extract the encoded table HTML
                        const encodedTableHtml = content.substring(tableStartIndex, tableEndIndex);

                        // Create a temporary div to decode HTML entities
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = encodedTableHtml;

                        // Get the decoded table HTML
                        let decodedTableHtml = tempDiv.textContent;

                        // Clean up the table HTML
                        decodedTableHtml = decodedTableHtml
                            .replace(/&nbsp;/g, '') // Remove &nbsp;
                            .replace(/\s+</g, '<')  // Remove whitespace before tags
                            .replace(/>\s+/g, '>')  // Remove whitespace after tags
                            .trim();

                        // Replace only the table part in the original content
                        const newContent = content.substring(0, tableStartIndex) +
                            decodedTableHtml +
                            content.substring(tableEndIndex);

                        // Update the content
                        itemDescription.innerHTML = newContent;
                    }
                } catch (error) {
                    console.error('Error processing table HTML in item-description:', error);
                }
            }
        });
    });
</script>

<style>
    /* Banner title styles */
    .banner-header .title {
        font-size: 46px !important;
        line-height: 68px !important;
        margin-bottom: -50px !important;
    }
    
    @media (max-width: 768px) {
        .banner-header .title {
            font-size: 28px;
            line-height: 36px;
        }
    }
    
    /* Table styles */
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border-radius: 4px;
        overflow: hidden;
        margin: 1.5rem 0;
        border: 1px solid #dddee1 !important;
    }
   
     .h-full{
        height: 100% !important;
     }


    .h-full img{
        height: 100%;
        object-fit: cover;
       
    }
    
  
    table th {
        padding: 0.75rem 1rem;
        text-align: left;
        border: none !important;
    }

    table td {
        padding: 0.75rem 1rem;
        text-align: left;
        color: black;
        border-bottom: 1px dashed #dddee19e !important;
    }

    table th {
        background-color: #f4f6f8 !important;
        font-weight: 600;
        color: black;
        border-bottom: 1px solid #f4f6f8 !important;
    }

    table .even-row {
        background-color: white !important;
    }

    table .odd-row {
        background-color: white !important;
    }

    /* Hover effect */
    table tbody tr:hover {
        background-color: #f4f6f8 !important;
    }

    /* Responsive styles */
    @media (max-width: 640px) {
        table {
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }

        table th,
        table td {
            padding: 0.5rem 0.75rem !important;
        }
    }

    .facebook-embed,
    .instagram-embed {
        margin: 20px 0;
        display: flex;
        justify-content: center;
    }

    .fb-video {
        width: 100% !important;
        max-width: 540px;
        min-width: 300px;
    }

    /* Blockquote styling */
    blockquote {
        border-left: 4px solid #007bff;
        padding-left: 20px;
        margin: 30px 0;
        font-style: italic;
        color: #555;
    }

    blockquote cite {
        display: block;
        margin-top: 10px;
        font-style: normal;
        font-weight: bold;
        color: #333;
    }

    /* Image styling */
    .rounded-2 {
        border-radius: 8px !important;
    }

    .img-fluid {
        max-width: 100%;
        height: auto;
    }

    /* Responsive text */
    @media (max-width:600px) {
        .blog-description p,
        .item-description p {
            font-size: 15px;
            line-height: 26px;
        }
    }
</style>